<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nunta Dianei și a lui Geo – Află masa ta</title>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0b0b0b;
      --card: #0f0f0f;
      --gold: #d4af37;
      --gold-2: #b8860b;
      --text: #ece7d9;
      --muted: #c8b892;
      --line: #2a2210;
      --danger: #c53030;
    }
    * { box-sizing: border-box; }
    body {
      background:
        radial-gradient(1200px 600px at 50% -10%, #1a1a1a 0%, #000 60%),
        linear-gradient(135deg, #0b0b0b 0%, #000 100%);
      color: var(--text);
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0; padding: 0; min-height: 100vh;
    }
    .container {
      max-width: 600px; background: var(--card);
      margin: 48px auto 40px; padding: 32px 28px 36px;
      border-radius: 2rem;
      border: 1px solid rgba(212,175,55,.35);
      box-shadow: inset 0 0 0 1px rgba(212,175,55,.12), 0 12px 50px rgba(0,0,0,.55);
      position: relative; z-index: 1;
    }
    .logo {
      display:block; width:120px; height:auto; margin:0 auto 12px; border-radius:9999px;
      box-shadow: 0 0 0 3px rgba(212,175,55,.12), 0 10px 30px rgba(0,0,0,.4);
    }
    .festive-title { font-family: 'Great Vibes', cursive; font-size: 2.6rem; color: var(--gold); margin-bottom: .25em; text-align: center; letter-spacing: 2px; text-shadow: 0 0 12px rgba(212,175,55,.15); }
    .festive-title::after {
      content: ""; display:block; height:20px; margin:6px auto 0;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 20"><path d="M5 10c30 0 30-8 60-8s30 8 60 8 30-8 60-8" stroke="%23d4af37" stroke-width="1.5" fill="none" stroke-linecap="round"/><circle cx="100" cy="10" r="2" fill="%23d4af37"/></svg>');
      background-size: 180px 20px; background-repeat:no-repeat; background-position:center; opacity:.95;
    }
    .subtitle { font-size: 1.1rem; color: var(--muted); text-align: center; margin-bottom: 16px; font-weight: 500; }
    .note { color: #d9c9a3; font-size: .95rem; text-align: center; margin-bottom: 18px; background: #111; border-radius: 8px; padding: 8px 12px; border:1px solid var(--line); }

    .actions { display: grid; grid-template-columns: 1fr; gap: 10px; margin: 8px 0 18px; }
    @media (min-width: 560px) { .actions { grid-template-columns: 1fr 1fr; } }
    .action-btn { display:inline-block; text-align:center; padding:12px 16px; border-radius:14px; background:linear-gradient(90deg, var(--gold) 0%, var(--gold-2) 100%); color:#0b0b0b; font-weight:700; text-decoration:none; border:none; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,.35); transition:transform .15s, filter .2s; }
    .action-btn:hover { transform: translateY(-1px); filter: brightness(1.05); }
    .action-btn.outline { background:transparent; color:var(--gold); border:2px solid rgba(212,175,55,.6); }
    .reveal-box { margin-top:6px; padding:10px 12px; background:#12100a; border:1px solid rgba(212,175,55,.35); color: var(--text); border-radius:12px; font-size:.98rem; }

    input[type="text"], input[type="password"], input[type="number"] { width:100%; padding:12px; border-radius:1rem; border:1px solid rgba(212,175,55,.35); background:#0b0b0b; color:var(--text); font-size:1.08rem; margin:8px 0 12px; outline:none; box-sizing:border-box; transition:border-color .2s, box-shadow .2s; }
    input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus { border-color: var(--gold); box-shadow: 0 0 0 3px rgba(212,175,55,.15); }
    input::placeholder { color:#9b8a5a; }

    .results { margin-top:10px; }
    .result-row { padding:10px 14px; margin:7px 0; background:#101010; border:1px solid rgba(212,175,55,.30); border-radius:12px; box-shadow: 0 2px 8px rgba(0,0,0,.25); display:flex; justify-content:space-between; align-items:center; font-size:1.08rem; }
    .guest-name { color:#f0ead6; font-weight:600; }
    .guest-table { color:var(--gold); font-size:1.13rem; font-weight:700; }
    .no-result { text-align:center; color:var(--gold); background:#15110a; border:1px solid rgba(212,175,55,.30); border-radius:9px; padding:9px; margin-top:14px; }
    .count { text-align:right; font-size:.9rem; color:#a89260; margin-top:6px; }

    /* Admin Panel */
    .admin-section { margin-top: 24px; background: #0d0d0d; border: 1px dashed rgba(212,175,55,.6); border-radius: 14px; padding: 16px; }
    .admin-section h3 { margin-top: 0; color: var(--gold); font-family: 'Great Vibes', cursive; font-size: 2rem; text-align: center; }
    .admin-login { display: flex; gap: 10px; align-items: center; }
    .admin-login input { flex-grow: 1; margin: 0; }
    .admin-controls { display: none; } /* Hidden by default */
    .admin-table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 16px; }
    .admin-table th { text-align: left; font-size: .9rem; color: var(--muted); padding-bottom: 5px; }
    .admin-table td { background: #0f0d08; padding: 8px; }
    .admin-table td:first-child { border-top-left-radius: 10px; border-bottom-left-radius: 10px; }
    .admin-table td:last-child { border-top-right-radius: 10px; border-bottom-right-radius: 10px; }
    .admin-table input { width: 100%; padding: 8px; margin: 0; border: 1px solid rgba(212,175,55,.35); border-radius: 8px; background: #0b0b0b; color: var(--text); box-sizing: border-box; font-size: 1rem; }
    .row-actions { display: flex; gap: 6px; justify-content: flex-end; }
    .small-btn { padding: 10px 12px; border-radius: 12px; border: none; background: linear-gradient(90deg, var(--gold), var(--gold-2)); color: #0b0b0b; font-weight: 700; cursor: pointer; box-shadow: 0 6px 16px rgba(0,0,0,.35); }
    .small-btn.outline { background: transparent; color: var(--gold); border: 2px solid rgba(212,175,55,.6); }
    .small-btn.danger { background: transparent; color: var(--danger); border-color: var(--danger); }
    .toolbar { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    .hint { font-size: .85rem; color: #a89260; margin-top: 6px; }

    .floral-divider { height:24px; margin:18px auto 0; background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 24"><path d="M5 12c30 0 30-8 60-8s30 8 60 8 30-8 60-8" stroke="%23d4af37" stroke-width="1.5" fill="none" stroke-linecap="round"/><circle cx="110" cy="12" r="2" fill="%23d4af37"/></svg>'); background-size: 200px 24px; background-repeat:no-repeat; background-position:center; opacity:.95; }
    .floral-divider.bottom { margin-top:22px; }

    .orn { position:absolute; width:34px; height:34px; background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M2 22c6-6 6-12 12-12" stroke="%23d4af37" stroke-width="1.4" fill="none" stroke-linecap="round"/><path d="M10 10c3 0 4 1 4 4" stroke="%23d4af37" stroke-width="1.2" fill="none" stroke-linecap="round"/><path d="M6 18c2-2 4-2 6-4" stroke="%23d4af37" stroke-width="1.2" fill="none" stroke-linecap="round"/></svg>'); background-size:contain; background-repeat:no-repeat; opacity:.9; filter:drop-shadow(0 2px 6px rgba(0,0,0,.5)); }
    .corner-tl { top:-10px; left:-10px; transform: rotate(0deg); }
    .corner-tr { top:-10px; right:-10px; transform: scaleX(-1); }
    .corner-bl { bottom:-10px; left:-10px; transform: scaleY(-1); }
    .corner-br { bottom:-10px; right:-10px; transform: scale(-1, -1); }
    .couple-wrap { margin: 14px 0 18px; }
    .couple { display:block; width:100%; height:auto; max-height:420px; object-fit:cover; border-radius:16px; border:1px solid rgba(212,175,55,.55); box-shadow: 0 10px 30px rgba(0,0,0,.45), inset 0 0 0 1px rgba(212,175,55,.12); }
    .couple-caption { text-align:center; color:var(--muted); font-size:.9rem; margin-top:6px; }
    #bg-wrap { position: fixed; inset: 0; z-index: 0; overflow: hidden; }
    #bgImage { width: 100%; height: 100%; object-fit: cover; transform: scale(1.02); filter: brightness(0.35) saturate(1.05); }
    #bg-wrap::after { content: ""; position: absolute; inset: 0; background: radial-gradient(1200px 600px at 50% -10%, rgba(0,0,0,.15), rgba(0,0,0,.55)), linear-gradient(180deg, rgba(212,175,55,.08), rgba(0,0,0,0) 40%); pointer-events: none; }
  </style>
</head>
<body>
  <div id="bg-wrap"><img id="bgImage" src="background.jpg" alt="" onerror="if(this.src.includes('background.jpg')){this.src='background.png';}else{this.parentNode.style.display='none';}"></div>
  
  <div class="container">
    <span class="orn corner-tl"></span>
    <span class="orn corner-tr"></span>
    <span class="orn corner-bl"></span>
    <span class="orn corner-br"></span>
    
    <img id="logo" class="logo" src="logo.png" alt="Nunta Diana & Geo" onerror="this.style.display='none'" />
    <div class="festive-title">Nunta Dianei și a lui Geo</div>
    
    <figure class="couple-wrap">
      <img id="couplePhoto" class="couple" src="couple.jpg" alt="Diana & Geo — la starea civilă" onerror="this.onerror=()=>this.closest('figure').style.display='none'; this.src='couple.png';" />
      <figcaption class="couple-caption">Diana & Geo — la starea civilă</figcaption>
    </figure>
    
    <div class="note">Formularul de mesaje permite și <strong>încărcarea opțională de fotografii</strong>. Numărul mesei va fi disponibil și fizic, la locație.</div>

    <div class="actions">
      <a href="https://forms.gle/Ji3SCJTNThM8GApL7" target="_blank" class="action-btn">Lasă mesaj / Încarcă poze</a>
      <button id="addressBtn" class="action-btn outline" type="button">Vezi adresa</button>
      <button id="contactBtn" class="action-btn outline" type="button">Contactează-ne</button>
    </div>
    <div id="addressBox" class="reveal-box" hidden><strong>Emerald, Salon Cristal (sala mică)</strong><br>Strada Ovid Densușeanu 78/A, Oradea 410237</div>
    <div id="contactBox" class="reveal-box" hidden>Georgian: 0754706716 &nbsp;&bull;&nbsp; Diana: 0748436309</div>

    <input type="text" id="search" placeholder="Căutați după orice parte din nume (cu sau fără diacritice)..." autofocus autocomplete="off" />
    <div class="count" id="count"></div>
    <div class="results" id="results"></div>
    
    <div class="floral-divider"></div>

    <!-- ===== Admin Panel ===== -->
    <section class="admin-section">
      <h3>Panou Admin</h3>
      <div id="adminLogin" class="admin-login">
        <input type="password" id="adminPassword" placeholder="Introduceți parola de admin...">
        <button id="adminLoginBtn" class="small-btn">Login</button>
      </div>
      <div id="adminControls" class="admin-controls">
        <p class="hint">Aici puteți adăuga, modifica sau șterge invitați. Modificările sunt salvate automat și vizibile instant pentru toată lumea.</p>
        <table class="admin-table">
          <thead>
            <tr>
              <th>Nume Invitat</th>
              <th>Masa</th>
              <th>Acțiuni</th>
            </tr>
          </thead>
          <tbody id="adminGuestList">
            <!-- Guest rows will be generated by JavaScript -->
          </tbody>
        </table>
        <div class="toolbar">
            <input type="text" id="newGuestName" placeholder="Nume invitat nou" style="flex-grow:1; margin:0;">
            <input type="number" id="newGuestTable" placeholder="Masa" style="width:80px; margin:0;">
            <button id="addGuestBtn" class="small-btn">Adaugă</button>
        </div>
        <button id="adminLogoutBtn" class="small-btn outline" style="margin-top: 16px;">Logout</button>
      </div>
    </section>

    <div class="floral-divider bottom"></div>
  </div>

  <script type="module">
    // ===== Import Firebase Modules =====
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // ===== Firebase Configuration =====
    const firebaseConfig = {
      apiKey: "AIzaSyB2BmOBNkpNuwUhORcbCV1HPjA49hb8B_c",
      authDomain: "invitati-nunta.firebaseapp.com",
      projectId: "invitati-nunta",
      storageBucket: "invitati-nunta.firebasestorage.app",
      messagingSenderId: "279470698992",
      appId: "1:279470698992:web:5171e9c80ac8354402ed35",
      measurementId: "G-KYVWR17HTB"
    };

    // ===== Initialize Firebase =====
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const guestsCollection = collection(db, 'guests');

    // ===== Global Variables & UI Elements =====
    let allGuests = [];
    const resultsDiv = document.getElementById('results');
    const countDiv = document.getElementById('count');
    const searchInput = document.getElementById('search');
    const addressBtn = document.getElementById('addressBtn');
    const contactBtn = document.getElementById('contactBtn');
    const addressBox = document.getElementById('addressBox');
    const contactBox = document.getElementById('contactBox');
    const adminLoginDiv = document.getElementById('adminLogin');
    const adminControlsDiv = document.getElementById('adminControls');
    const adminPasswordInput = document.getElementById('adminPassword');
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const adminLogoutBtn = document.getElementById('adminLogoutBtn');
    const adminGuestListBody = document.getElementById('adminGuestList');
    const addGuestBtn = document.getElementById('addGuestBtn');
    const newGuestNameInput = document.getElementById('newGuestName');
    const newGuestTableInput = document.getElementById('newGuestTable');
    const ADMIN_PASS_KEY = 'nuntaDianaGeoAdminPass';

    // ===== Main App Logic =====
    async function initialize() {
      try {
        await signInAnonymously(auth);
        console.log("Signed in anonymously.");
        setupListeners();
      } catch (error) {
        console.error("Authentication or Firestore error:", error);
        resultsDiv.innerHTML = `<div class="no-result">Eroare de conectare la baza de date. Vă rugăm reîncărcați pagina.</div>`;
      }
    }
    
    function setupListeners() {
      // Real-time data listener
      onSnapshot(guestsCollection, (snapshot) => {
        allGuests = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        console.log(`Loaded ${allGuests.length} guests from Firebase.`);
        if (searchInput.value.trim() !== '') {
            renderResults(filterList(searchInput.value));
        }
        if (adminControlsDiv.style.display !== 'none') {
          renderAdminList();
        }
      }, (error) => {
          console.error("Firestore snapshot error:", error);
          resultsDiv.innerHTML = `<div class="no-result">Eroare: ${error.message}. Verificați regulile de securitate din Firebase.</div>`;
      });

      // Search input listener
      searchInput.addEventListener('input', () => {
        const term = searchInput.value;
        if (term.trim() === '') {
          resultsDiv.innerHTML = '';
          countDiv.textContent = '';
          return;
        }
        const filtered = filterList(term);
        if (filtered.length === 0) {
          resultsDiv.innerHTML = '<div class="no-result">Nu există invitat cu acest nume.</div>';
          countDiv.textContent = '';
          return;
        }
        renderResults(filtered);
      });

      // Admin panel listeners
      adminLoginBtn.addEventListener('click', () => {
        const pass = adminPasswordInput.value;
        if (pass) {
            localStorage.setItem(ADMIN_PASS_KEY, pass);
            showAdminControls();
            adminPasswordInput.value = '';
        } else {
            alert('Vă rugăm introduceți o parolă.');
        }
      });

      adminLogoutBtn.addEventListener('click', showAdminLogin);

      addGuestBtn.addEventListener('click', async () => {
        const name = newGuestNameInput.value.trim();
        const table = parseInt(newGuestTableInput.value, 10);
        if (name && table > 0) {
            try {
                await addDoc(guestsCollection, { Nume: name, Masa: table });
                newGuestNameInput.value = '';
                newGuestTableInput.value = '';
            } catch (error) {
                console.error("Error adding document: ", error);
                alert("A apărut o eroare la adăugarea invitatului.");
            }
        } else {
            alert("Vă rugăm completați numele și masa invitatului.");
        }
      });
      
      adminGuestListBody.addEventListener('click', async (e) => {
        const target = e.target;
        const id = target.dataset.id;
        if (!id) return;

        const guestRef = doc(db, 'guests', id);

        if (target.classList.contains('delete-btn')) {
            if (confirm(`Sunteți sigur că doriți să ștergeți invitatul "${target.closest('tr').querySelector('.admin-guest-name').value}"?`)) {
                try {
                    await deleteDoc(guestRef);
                } catch (error) {
                    console.error("Error deleting document: ", error);
                    alert("A apărut o eroare la ștergerea invitatului.");
                }
            }
        }

        if (target.classList.contains('save-btn')) {
            const row = target.closest('tr');
            const name = row.querySelector('.admin-guest-name').value.trim();
            const table = parseInt(row.querySelector('.admin-guest-table').value, 10);
            
            if (name && table > 0) {
                try {
                    await updateDoc(guestRef, { Nume: name, Masa: table });
                    alert('Invitat actualizat cu succes!');
                } catch (error) {
                    console.error("Error updating document: ", error);
                    alert("A apărut o eroare la actualizarea invitatului.");
                }
            } else {
                alert("Numele și masa nu pot fi goale.");
            }
        }
      });
    }

    // ===== Helper Functions =====
    function renderResults(list) {
      resultsDiv.innerHTML = '';
      countDiv.textContent = '';
      if (!Array.isArray(list) || list.length === 0) return;
      
      const sortedList = list.sort((a,b)=> (a.Masa-b.Masa) || a.Nume.localeCompare(b.Nume));

      sortedList.forEach(g => {
        const row = document.createElement('div');
        row.className = 'result-row';
        row.innerHTML = `<span class="guest-name">${g.Nume}</span> <span class="guest-table">Masa ${g.Masa}</span>`;
        resultsDiv.appendChild(row);
      });
      countDiv.textContent = list.length + ' invitați afișați';
    }

    function normalizeString(s) {
      return (s || '')
        .toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
        .replace(/[șş]/g, 's').replace(/[țţ]/g, 't')
        .replace(/[^a-z0-9 ]+/g, ' ')
        .replace(/\s+/g, ' ')
        .trim();
    }

    function filterList(term) {
      const key = normalizeString(term);
      if (!key) return [];
      return allGuests.filter(g => normalizeString(g.Nume).includes(key));
    }

    function showAdminControls() {
        adminLoginDiv.style.display = 'none';
        adminControlsDiv.style.display = 'block';
        renderAdminList();
    }

    function showAdminLogin() {
        adminLoginDiv.style.display = 'flex';
        adminControlsDiv.style.display = 'none';
        localStorage.removeItem(ADMIN_PASS_KEY);
    }

    function renderAdminList() {
        adminGuestListBody.innerHTML = '';
        const sortedGuests = [...allGuests].sort((a,b) => a.Nume.localeCompare(b.Nume));
        sortedGuests.forEach(guest => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" class="admin-guest-name" value="${guest.Nume}" data-id="${guest.id}"></td>
                <td><input type="number" class="admin-guest-table" value="${guest.Masa}" data-id="${guest.id}" style="width: 70px;"></td>
                <td class="row-actions">
                    <button class="small-btn save-btn" data-id="${guest.id}">Salvează</button>
                    <button class="small-btn danger delete-btn" data-id="${guest.id}">Șterge</button>
                </td>
            `;
            adminGuestListBody.appendChild(row);
        });
    }

    // ===== Simple UI Listeners & App Start =====
    addressBtn.addEventListener('click', ()=> { addressBox.hidden = !addressBox.hidden; });
    contactBtn.addEventListener('click', ()=> { contactBox.hidden = !contactBox.hidden; });
    
    if (localStorage.getItem(ADMIN_PASS_KEY)) {
        showAdminControls();
    }

    window.onload = () => {
      searchInput.focus();
      initialize();
    };
  </script>
</body>
</html>

